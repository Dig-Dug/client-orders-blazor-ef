@page "/clients/create"
@using ClientOrders.Core
@using ClientOrders.Infrastructure
@inject AppDbContext Db
@inject NavigationManager Nav
@inject ISnackbar Snackbar

<MudPaper Class="pa-6 mx-auto" MaxWidth="400px" Elevation="4">
    <MudText Typo="Typo.h5" Class="mb-4">Create Client</MudText>
    <MudTextField @bind-Value="_client.Name"
        Label="Client Name"
        Required="true"
        Immediate="true"
        Class="mb-4"
        />
    @if (!string.IsNullOrWhiteSpace(error))
    {
        <MudText Color="Color.Error" Class="mb-2">@error</MudText>
    }
    <MudStack Row="true" Spacing="2">
        <MudButton Variant="Variant.Filled"
             Color="Color.Primary"
             OnClick="Save"
        >Save</MudButton>
        <MudButton Variant="Variant.Outlined"
        Color="Color.Secondary"
        OnClick="Cancel"
        >Cancel</MudButton>

    </MudStack>
</MudPaper>

@code {
    private Client _client = new();
    private string? error;

    private async Task Save()
    {
        if (string.IsNullOrWhiteSpace(_client.Name))
        {
            error = "Client name is required.";
            return;
        }
        Db.Clients.Add(_client);
        await Db.SaveChangesAsync();
        Snackbar.Add("Client created", Severity.Success);
        Nav.NavigateTo("/clients");
    }
    private void Cancel()
    {
        Nav.NavigateTo("/clients");
    }
}
